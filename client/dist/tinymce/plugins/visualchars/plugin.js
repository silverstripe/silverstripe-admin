!function(){"use strict";var t=tinymce.util.Tools.resolve("tinymce.PluginManager");const e=t=>e=>(t=>{const e=typeof t;return null===t?"null":"object"===e&&Array.isArray(t)?"array":"object"===e&&(o=r=t,n=(s=String).prototype,n.isPrototypeOf(o)||(null===(a=r.constructor)||void 0===a?void 0:a.name)===s.name)?"string":e;var o,n;var r,s,a})(e)===t,o=t=>e=>typeof e===t,n=e("string"),r=e("object"),s=(a=null,t=>a===t);var a;const l=o("boolean"),i=o("number");class u{constructor(t,e){this.tag=t,this.value=e}static some(t){return new u(!0,t)}static none(){return u.singletonNone}fold(t,e){return this.tag?e(this.value):t()}isSome(){return this.tag}isNone(){return!this.tag}map(t){return this.tag?u.some(t(this.value)):u.none()}bind(t){return this.tag?t(this.value):u.none()}exists(t){return this.tag&&t(this.value)}forall(t){return!this.tag||t(this.value)}filter(t){return!this.tag||t(this.value)?this:u.none()}getOr(t){return this.tag?this.value:t}or(t){return this.tag?this:t}getOrThunk(t){return this.tag?this.value:t()}orThunk(t){return this.tag?this:t()}getOrDie(t){if(this.tag)return this.value;throw new Error(null!=t?t:"Called getOrDie on None")}static from(t){return(t=>null==t)(t)?u.none():u.some(t)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(t){this.tag&&t(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}u.singletonNone=new u(!1);const c=(t,e)=>{for(let o=0,n=t.length;o<n;o++){e(t[o],o)}},d=Object.keys,m=(t,e)=>{const o=d(t);for(let n=0,r=o.length;n<r;n++){const r=o[n];e(t[r],r)}},h="undefined"!=typeof window?window:Function("return this;")(),g=(t,e)=>((t,e)=>{let o=null!=e?e:h;for(let e=0;e<t.length&&null!=o;++e)o=o[t[e]];return o})(t.split("."),e),v=(t,e)=>{const o=((t,e)=>g(t,e))(t,e);if(null==o)throw new Error(t+" not available on this browser");return o},f=Object.getPrototypeOf,p=t=>{const e=g("ownerDocument.defaultView",t);return r(t)&&((t=>v("HTMLElement",t))(e).prototype.isPrototypeOf(t)||/^HTML\w*Element$/.test(f(t).constructor.name))},w=t=>t.dom.nodeValue,b=t=>e=>(t=>t.dom.nodeType)(e)===t,y=t=>N(t)&&p(t.dom),N=b(1),T=b(3),A=(t,e,o)=>{((t,e,o)=>{if(!(n(o)||l(o)||i(o)))throw console.error("Invalid call to Attribute.set. Key ",e,":: Value ",o,":: Element ",t),new Error("Attribute value was not simple");t.setAttribute(e,o+"")})(t.dom,e,o)},E=(t,e)=>{t.dom.removeAttribute(e)},k=(t,e)=>{const o=((t,e)=>{const o=t.dom.getAttribute(e);return null===o?void 0:o})(t,e);return void 0===o||""===o?[]:o.split(" ")},C=t=>void 0!==t.dom.classList,O=(t,e)=>((t,e,o)=>{const n=k(t,e).concat([o]);return A(t,e,n.join(" ")),!0})(t,"class",e),L=(t,e)=>((t,e,o)=>{const n=((t,e)=>{const o=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];e(r,n)&&o.push(r)}return o})(k(t,e),(t=>t!==o));return n.length>0?A(t,e,n.join(" ")):E(t,e),!1})(t,"class",e),D=t=>{const e=C(t)?t.dom.classList:(t=>k(t,"class"))(t);0===e.length&&E(t,"class")},V=t=>{if(null==t)throw new Error("Node cannot be null or undefined");return{dom:t}},j={fromHtml:(t,e)=>{const o=(e||document).createElement("div");if(o.innerHTML=t,!o.hasChildNodes()||o.childNodes.length>1){const e="HTML does not have a single root node";throw console.error(e,t),new Error(e)}return V(o.childNodes[0])},fromTag:(t,e)=>{const o=(e||document).createElement(t);return V(o)},fromText:(t,e)=>{const o=(e||document).createTextNode(t);return V(o)},fromDom:V,fromPoint:(t,e,o)=>u.from(t.dom.elementFromPoint(e,o)).map(V)},B={" ":"nbsp","­":"shy"},S=(t,e)=>{let o="";return m(t,((t,e)=>{o+=e})),new RegExp("["+o+"]",e?"g":"")},x=S(B),M=S(B,!0),P=(t=>{let e="";return m(t,(t=>{e&&(e+=","),e+="span.mce-"+t})),e})(B),H="mce-nbsp",_=t=>t.dom.contentEditable,F=t=>'<span data-mce-bogus="1" class="mce-'+B[t]+'">'+t+"</span>",I=t=>"span"===t.nodeName.toLowerCase()&&t.classList.contains("mce-nbsp-wrap"),$=t=>{const e=w(t);return T(t)&&n(e)&&x.test(e)},K=(t,e,o)=>{let n=[];const r=((t,e)=>{const o=t.length,n=new Array(o);for(let r=0;r<o;r++){const o=t[r];n[r]=e(o,r)}return n})(t.dom.childNodes,j.fromDom),s=t=>I(t.dom)||!(t=>y(t)&&"false"===_(t))(t);return c(r,(t=>{o&&s(t)&&e(t)&&(n=n.concat([t])),n=n.concat(K(t,e,((t,e)=>{if(y(t)&&!I(t.dom)){const e=_(t);if("true"===e)return!0;if("false"===e)return!1}return e})(t,o)))})),n},R=(t,e)=>{const o=t.dom,n=K(j.fromDom(e),$,t.dom.isEditable(e));c(n,(e=>{var n;const r=e.dom.parentNode;if(I(r))s=j.fromDom(r),a=H,C(s)?s.dom.classList.add(a):O(s,a);else{const r=o.encode(null!==(n=w(e))&&void 0!==n?n:"").replace(M,F),s=o.create("div",{},r);let a;for(;a=s.lastChild;)o.insertAfter(a,e.dom);t.dom.remove(e.dom)}var s,a}))},U=(t,e)=>{const o=t.dom.select(P,e);c(o,(e=>{I(e)?((t,e)=>{C(t)?t.dom.classList.remove(e):L(t,e);D(t)})(j.fromDom(e),H):t.dom.remove(e,!0)}))},q=t=>{const e=t.getBody(),o=t.selection.getBookmark();let n=((t,e)=>{for(;t.parentNode;){if(t.parentNode===e)return e;t=t.parentNode}})(t.selection.getNode(),e);n=void 0!==n?n:e,U(t,n),R(t,n),t.selection.moveToBookmark(o)},z=(t,e)=>{((t,e)=>{t.dispatch("VisualChars",{state:e})})(t,e.get());const o=t.getBody();!0===e.get()?R(t,o):U(t,o)},G=(t,e)=>{t.addCommand("mceVisualChars",(()=>{((t,e)=>{e.set(!e.get());const o=t.selection.getBookmark();z(t,e),t.selection.moveToBookmark(o)})(t,e)}))},J=(Q="visualchars_default_state",t=>t.options.get(Q));var Q;const W=(t,e)=>{const o=((t,e)=>{let o=null;return{cancel:()=>{s(o)||(clearTimeout(o),o=null)},throttle:(...n)=>{s(o)&&(o=setTimeout((()=>{o=null,t.apply(null,n)}),e))}}})((()=>{q(t)}),300);t.on("keydown",(n=>{!0===e.get()&&(13===n.keyCode?q(t):o.throttle())})),t.on("remove",o.cancel)},X=(t,e)=>o=>{o.setActive(e.get());const n=t=>o.setActive(t.state);return t.on("VisualChars",n),()=>t.off("VisualChars",n)};t.add("visualchars",(t=>{(t=>{(0,t.options.register)("visualchars_default_state",{processor:"boolean",default:!1})})(t);const e=(t=>{let e=t;return{get:()=>e,set:t=>{e=t}}})(J(t));return G(t,e),((t,e)=>{const o=()=>t.execCommand("mceVisualChars");t.ui.registry.addToggleButton("visualchars",{tooltip:"Show invisible characters",icon:"visualchars",onAction:o,onSetup:X(t,e)}),t.ui.registry.addToggleMenuItem("visualchars",{text:"Show invisible characters",icon:"visualchars",onAction:o,onSetup:X(t,e)})})(t,e),W(t,e),((t,e)=>{t.on("init",(()=>{z(t,e)}))})(t,e),(t=>({isEnabled:()=>t.get()}))(e)}))}();