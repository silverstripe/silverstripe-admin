!function(){"use strict";var t=tinymce.util.Tools.resolve("tinymce.PluginManager");const e=t=>e=>typeof e===t,o=(t=>e=>(t=>{const e=typeof t;return null===t?"null":"object"===e&&Array.isArray(t)?"array":"object"===e&&(o=r=t,n=(s=String).prototype,n.isPrototypeOf(o)||(null===(a=r.constructor)||void 0===a?void 0:a.name)===s.name)?"string":e;var o,n;var r,s,a})(e)===t)("string"),n=(r=null,t=>r===t);var r;const s=e("boolean"),a=e("number");class i{constructor(t,e){this.tag=t,this.value=e}static some(t){return new i(!0,t)}static none(){return i.singletonNone}fold(t,e){return this.tag?e(this.value):t()}isSome(){return this.tag}isNone(){return!this.tag}map(t){return this.tag?i.some(t(this.value)):i.none()}bind(t){return this.tag?t(this.value):i.none()}exists(t){return this.tag&&t(this.value)}forall(t){return!this.tag||t(this.value)}filter(t){return!this.tag||t(this.value)?this:i.none()}getOr(t){return this.tag?this.value:t}or(t){return this.tag?this:t}getOrThunk(t){return this.tag?this.value:t()}orThunk(t){return this.tag?this:t()}getOrDie(t){if(this.tag)return this.value;throw new Error(null!=t?t:"Called getOrDie on None")}static from(t){return(t=>null==t)(t)?i.none():i.some(t)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(t){this.tag&&t(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}i.singletonNone=new i(!1);const l=(t,e)=>{for(let o=0,n=t.length;o<n;o++){e(t[o],o)}},c=Object.keys,u=(t,e)=>{const o=c(t);for(let n=0,r=o.length;n<r;n++){const r=o[n];e(t[r],r)}};"undefined"!=typeof window?window:Function("return this;")();const d=t=>t.dom.nodeValue,m=(t=>e=>(t=>t.dom.nodeType)(e)===t)(3),h=(t,e,n)=>{((t,e,n)=>{if(!(o(n)||s(n)||a(n)))throw console.error("Invalid call to Attribute.set. Key ",e,":: Value ",n,":: Element ",t),new Error("Attribute value was not simple");t.setAttribute(e,n+"")})(t.dom,e,n)},g=(t,e)=>{t.dom.removeAttribute(e)},v=(t,e)=>{const o=((t,e)=>{const o=t.dom.getAttribute(e);return null===o?void 0:o})(t,e);return void 0===o||""===o?[]:o.split(" ")},f=t=>void 0!==t.dom.classList,p=(t,e)=>((t,e,o)=>{const n=v(t,e).concat([o]);return h(t,e,n.join(" ")),!0})(t,"class",e),y=(t,e)=>((t,e,o)=>{const n=((t,e)=>{const o=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];e(r,n)&&o.push(r)}return o})(v(t,e),(t=>t!==o));return n.length>0?h(t,e,n.join(" ")):g(t,e),!1})(t,"class",e),w=t=>{const e=f(t)?t.dom.classList:(t=>v(t,"class"))(t);0===e.length&&g(t,"class")},b=t=>{if(null==t)throw new Error("Node cannot be null or undefined");return{dom:t}},N={fromHtml:(t,e)=>{const o=(e||document).createElement("div");if(o.innerHTML=t,!o.hasChildNodes()||o.childNodes.length>1){const e="HTML does not have a single root node";throw console.error(e,t),new Error(e)}return b(o.childNodes[0])},fromTag:(t,e)=>{const o=(e||document).createElement(t);return b(o)},fromText:(t,e)=>{const o=(e||document).createTextNode(t);return b(o)},fromDom:b,fromPoint:(t,e,o)=>i.from(t.dom.elementFromPoint(e,o)).map(b)},T={" ":"nbsp","­":"shy"},A=(t,e)=>{let o="";return u(t,((t,e)=>{o+=e})),new RegExp("["+o+"]",e?"g":"")},k=A(T),C=A(T,!0),E=(t=>{let e="";return u(t,(t=>{e&&(e+=","),e+="span.mce-"+t})),e})(T),L="mce-nbsp",O=t=>'<span data-mce-bogus="1" class="mce-'+T[t]+'">'+t+"</span>",B=t=>{const e=d(t);return m(t)&&o(e)&&k.test(e)},D=(t,e)=>{let o=[];const n=((t,e)=>{const o=t.length,n=new Array(o);for(let r=0;r<o;r++){const o=t[r];n[r]=e(o,r)}return n})(t.dom.childNodes,N.fromDom);return l(n,(t=>{e(t)&&(o=o.concat([t])),o=o.concat(D(t,e))})),o},S=t=>"span"===t.nodeName.toLowerCase()&&t.classList.contains("mce-nbsp-wrap"),V=(t,e)=>{const o=t.dom,n=D(N.fromDom(e),B);l(n,(e=>{var n;const r=e.dom.parentNode;if(S(r))s=N.fromDom(r),a=L,f(s)?s.dom.classList.add(a):p(s,a);else{const r=o.encode(null!==(n=d(e))&&void 0!==n?n:"").replace(C,O),s=o.create("div",{},r);let a;for(;a=s.lastChild;)o.insertAfter(a,e.dom);t.dom.remove(e.dom)}var s,a}))},x=(t,e)=>{const o=t.dom.select(E,e);l(o,(e=>{S(e)?((t,e)=>{f(t)?t.dom.classList.remove(e):y(t,e);w(t)})(N.fromDom(e),L):t.dom.remove(e,!0)}))},j=t=>{const e=t.getBody(),o=t.selection.getBookmark();let n=((t,e)=>{for(;t.parentNode;){if(t.parentNode===e)return e;t=t.parentNode}})(t.selection.getNode(),e);n=void 0!==n?n:e,x(t,n),V(t,n),t.selection.moveToBookmark(o)},M=(t,e)=>{((t,e)=>{t.dispatch("VisualChars",{state:e})})(t,e.get());const o=t.getBody();!0===e.get()?V(t,o):x(t,o)},P=(t,e)=>{t.addCommand("mceVisualChars",(()=>{((t,e)=>{e.set(!e.get());const o=t.selection.getBookmark();M(t,e),t.selection.moveToBookmark(o)})(t,e)}))},_=(H="visualchars_default_state",t=>t.options.get(H));var H;const F=(t,e)=>{const o=((t,e)=>{let o=null;return{cancel:()=>{n(o)||(clearTimeout(o),o=null)},throttle:(...r)=>{n(o)&&(o=setTimeout((()=>{o=null,t.apply(null,r)}),e))}}})((()=>{j(t)}),300);t.on("keydown",(n=>{!0===e.get()&&(13===n.keyCode?j(t):o.throttle())})),t.on("remove",o.cancel)},I=(t,e)=>o=>{o.setActive(e.get());const n=t=>o.setActive(t.state);return t.on("VisualChars",n),()=>t.off("VisualChars",n)};t.add("visualchars",(t=>{(t=>{(0,t.options.register)("visualchars_default_state",{processor:"boolean",default:!1})})(t);const e=(t=>{let e=t;return{get:()=>e,set:t=>{e=t}}})(_(t));return P(t,e),((t,e)=>{const o=()=>t.execCommand("mceVisualChars");t.ui.registry.addToggleButton("visualchars",{tooltip:"Show invisible characters",icon:"visualchars",onAction:o,onSetup:I(t,e)}),t.ui.registry.addToggleMenuItem("visualchars",{text:"Show invisible characters",icon:"visualchars",onAction:o,onSetup:I(t,e)})})(t,e),F(t,e),((t,e)=>{t.on("init",(()=>{M(t,e)}))})(t,e),(t=>({isEnabled:()=>t.get()}))(e)}))}();