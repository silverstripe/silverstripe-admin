!function(){"use strict";var t=tinymce.util.Tools.resolve("tinymce.PluginManager");const e=t=>e=>(t=>{const e=typeof t;return null===t?"null":"object"===e&&Array.isArray(t)?"array":"object"===e&&(n=r=t,o=(s=String).prototype,o.isPrototypeOf(n)||(null===(i=r.constructor)||void 0===i?void 0:i.name)===s.name)?"string":e;var n,o;var r,s,i})(e)===t,n=t=>e=>typeof e===t,o=e("string"),r=e("object"),s=e("array"),i=n("boolean"),a=t=>!(t=>null==t)(t),l=n("function"),d=n("number"),c=()=>{},m=(t,e)=>t===e,u=t=>e=>!t(e),p=(g=!1,()=>g);var g;class f{constructor(t,e){this.tag=t,this.value=e}static some(t){return new f(!0,t)}static none(){return f.singletonNone}fold(t,e){return this.tag?e(this.value):t()}isSome(){return this.tag}isNone(){return!this.tag}map(t){return this.tag?f.some(t(this.value)):f.none()}bind(t){return this.tag?t(this.value):f.none()}exists(t){return this.tag&&t(this.value)}forall(t){return!this.tag||t(this.value)}filter(t){return!this.tag||t(this.value)?this:f.none()}getOr(t){return this.tag?this.value:t}or(t){return this.tag?this:t}getOrThunk(t){return this.tag?this.value:t()}orThunk(t){return this.tag?this:t()}getOrDie(t){if(this.tag)return this.value;throw new Error(null!=t?t:"Called getOrDie on None")}static from(t){return a(t)?f.some(t):f.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(t){this.tag&&t(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}f.singletonNone=new f(!1);const h=Array.prototype.slice,y=Array.prototype.indexOf,v=Array.prototype.push,C=(t,e)=>{return n=t,o=e,y.call(n,o)>-1;var n,o},b=(t,e)=>{for(let n=0,o=t.length;n<o;n++){if(e(t[n],n))return!0}return!1},S=(t,e)=>{const n=t.length,o=new Array(n);for(let r=0;r<n;r++){const n=t[r];o[r]=e(n,r)}return o},N=(t,e)=>{for(let n=0,o=t.length;n<o;n++){e(t[n],n)}},L=(t,e)=>{const n=[];for(let o=0,r=t.length;o<r;o++){const r=t[o];e(r,o)&&n.push(r)}return n},T=(t,e,n)=>(N(t,((t,o)=>{n=e(n,t,o)})),n),D=(t,e,n)=>{for(let o=0,r=t.length;o<r;o++){const r=t[o];if(e(r,o))return f.some(r);if(n(r,o))break}return f.none()},O=(t,e)=>D(t,e,p),k=(t,e)=>(t=>{const e=[];for(let n=0,o=t.length;n<o;++n){if(!s(t[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+t);v.apply(e,t[n])}return e})(S(t,e)),A=t=>{const e=h.call(t,0);return e.reverse(),e},w=(t,e)=>e>=0&&e<t.length?f.some(t[e]):f.none(),E=t=>w(t,0),x=t=>w(t,t.length-1),B=(t,e)=>{const n=[],o=l(e)?t=>b(n,(n=>e(n,t))):t=>C(n,t);for(let e=0,r=t.length;e<r;e++){const r=t[e];o(r)||n.push(r)}return n},P=(t,e,n=m)=>t.exists((t=>n(t,e))),M=(t,e,n)=>t.isSome()&&e.isSome()?f.some(n(t.getOrDie(),e.getOrDie())):f.none(),I=t=>{if(null==t)throw new Error("Node cannot be null or undefined");return{dom:t}},R={fromHtml:(t,e)=>{const n=(e||document).createElement("div");if(n.innerHTML=t,!n.hasChildNodes()||n.childNodes.length>1){const e="HTML does not have a single root node";throw console.error(e,t),new Error(e)}return I(n.childNodes[0])},fromTag:(t,e)=>{const n=(e||document).createElement(t);return I(n)},fromText:(t,e)=>{const n=(e||document).createTextNode(t);return I(n)},fromDom:I,fromPoint:(t,e,n)=>f.from(t.dom.elementFromPoint(e,n)).map(I)},U=(t,e)=>t.dom===e.dom,$=(t,e)=>{const n=t.dom;if(1!==n.nodeType)return!1;{const t=n;if(void 0!==t.matches)return t.matches(e);if(void 0!==t.msMatchesSelector)return t.msMatchesSelector(e);if(void 0!==t.webkitMatchesSelector)return t.webkitMatchesSelector(e);if(void 0!==t.mozMatchesSelector)return t.mozMatchesSelector(e);throw new Error("Browser lacks native selectors")}};"undefined"!=typeof window?window:Function("return this;")();const _=t=>t.dom.nodeName.toLowerCase(),H=(F=1,t=>(t=>t.dom.nodeType)(t)===F);var F;const j=t=>e=>H(e)&&_(e)===t,K=t=>f.from(t.dom.parentNode).map(R.fromDom),V=t=>S(t.dom.childNodes,R.fromDom),z=(t,e)=>{const n=t.dom.childNodes;return f.from(n[e]).map(R.fromDom)},Q=t=>z(t,0),q=t=>z(t,t.dom.childNodes.length-1),W=(t,e,n)=>{let o=t.dom;const r=l(n)?n:p;for(;o.parentNode;){o=o.parentNode;const t=R.fromDom(o);if(e(t))return f.some(t);if(r(t))break}return f.none()},Z=(t,e,n)=>((t,e,n,o,r)=>t(n,o)?f.some(n):l(r)&&r(n)?f.none():e(n,o,r))(((t,e)=>e(t)),W,t,e,n),G=(t,e)=>{K(t).each((n=>{n.dom.insertBefore(e.dom,t.dom)}))},J=(t,e)=>{const n=(t=>f.from(t.dom.nextSibling).map(R.fromDom))(t);n.fold((()=>{K(t).each((t=>{X(t,e)}))}),(t=>{G(t,e)}))},X=(t,e)=>{t.dom.appendChild(e.dom)},Y=(t,e)=>{N(e,(e=>{X(t,e)}))},tt=t=>{t.dom.textContent="",N(V(t),(t=>{et(t)}))},et=t=>{const e=t.dom;null!==e.parentNode&&e.parentNode.removeChild(e)};var nt=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),ot=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),rt=tinymce.util.Tools.resolve("tinymce.util.VK");const st=t=>S(t,R.fromDom),it=Object.keys,at=(t,e)=>{const n=it(t);for(let o=0,r=n.length;o<r;o++){const r=n[o];e(t[r],r)}},lt=(t,e)=>{const n={};var o;return((t,e,n,o)=>{at(t,((t,r)=>{(e(t,r)?n:o)(t,r)}))})(t,e,(o=n,(t,e)=>{o[e]=t}),c),n},dt=(t,e)=>{const n=t.dom;at(e,((t,e)=>{((t,e,n)=>{if(!(o(n)||i(n)||d(n)))throw console.error("Invalid call to Attribute.set. Key ",e,":: Value ",n,":: Element ",t),new Error("Attribute value was not simple");t.setAttribute(e,n+"")})(n,e,t)}))},ct=t=>T(t.dom.attributes,((t,e)=>(t[e.name]=e.value,t)),{}),mt=t=>((t,e)=>R.fromDom(t.dom.cloneNode(e)))(t,!0),ut=(t,e)=>{const n=((t,e)=>{const n=R.fromTag(e),o=ct(t);return dt(n,o),n})(t,e);J(t,n);const o=V(t);return Y(n,o),et(t),n};var pt=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),gt=tinymce.util.Tools.resolve("tinymce.util.Tools");const ft=t=>e=>a(e)&&e.nodeName.toLowerCase()===t,ht=t=>e=>a(e)&&t.test(e.nodeName),yt=t=>a(t)&&3===t.nodeType,vt=t=>a(t)&&1===t.nodeType,Ct=ht(/^(OL|UL|DL)$/),bt=ht(/^(OL|UL)$/),St=ft("ol"),Nt=ht(/^(LI|DT|DD)$/),Lt=ht(/^(DT|DD)$/),Tt=ht(/^(TH|TD)$/),Dt=ft("br"),Ot=(t,e)=>a(e)&&e.nodeName in t.schema.getTextBlockElements(),kt=(t,e)=>a(t)&&t.nodeName in e,At=(t,e,n)=>{const o=t.isEmpty(e);return!(n&&t.select("span[data-mce-type=bookmark]",e).length>0)&&o},wt=(t,e)=>t.isChildOf(e,t.getRoot()),Et=t=>e=>e.options.get(t),xt=Et("lists_indent_on_tab"),Bt=Et("forced_root_block"),Pt=Et("forced_root_block_attrs"),Mt=(t,e)=>{const n=t.dom,o=t.schema.getBlockElements(),r=n.createFragment(),s=Bt(t),i=Pt(t);let a,l,d=!1;for(l=n.create(s,i),kt(e.firstChild,o)||r.appendChild(l);a=e.firstChild;){const t=a.nodeName;d||"SPAN"===t&&"bookmark"===a.getAttribute("data-mce-type")||(d=!0),kt(a,o)?(r.appendChild(a),l=null):(l||(l=n.create(s,i),r.appendChild(l)),l.appendChild(a))}return!d&&l&&l.appendChild(n.create("br",{"data-mce-bogus":"1"})),r},It=pt.DOM,Rt=(t,e,n)=>{const o=It.select('span[data-mce-type="bookmark"]',e),r=Mt(t,n),s=It.createRng();s.setStartAfter(n),s.setEndAfter(e);const i=s.extractContents();for(let e=i.firstChild;e;e=e.firstChild)if("LI"===e.nodeName&&t.dom.isEmpty(e)){It.remove(e);break}t.dom.isEmpty(i)||It.insertAfter(i,e),It.insertAfter(r,e);const a=n.parentElement;a&&At(t.dom,a)&&(t=>{const e=t.parentNode;e&&gt.each(o,(t=>{e.insertBefore(t,n.parentNode)})),It.remove(t)})(a),It.remove(n),At(t.dom,e)&&It.remove(e)},Ut=j("dd"),$t=j("dt"),_t=(t,e)=>{var n;Ut(e)?ut(e,"dt"):$t(e)&&(n=e,f.from(n.dom.parentElement).map(R.fromDom)).each((n=>Rt(t,n.dom,e.dom)))},Ht=t=>{$t(t)&&ut(t,"dd")},Ft=(t,e)=>{if(yt(t))return{container:t,offset:e};const n=nt.getNode(t,e);return yt(n)?{container:n,offset:e>=t.childNodes.length?n.data.length:0}:n.previousSibling&&yt(n.previousSibling)?{container:n.previousSibling,offset:n.previousSibling.data.length}:n.nextSibling&&yt(n.nextSibling)?{container:n.nextSibling,offset:0}:{container:t,offset:e}},jt=t=>{const e=t.cloneRange(),n=Ft(t.startContainer,t.startOffset);e.setStart(n.container,n.offset);const o=Ft(t.endContainer,t.endOffset);return e.setEnd(o.container,o.offset),e},Kt=["OL","UL","DL"],Vt=Kt.join(","),zt=(t,e)=>{const n=e||t.selection.getStart(!0);return t.dom.getParent(n,Vt,Zt(t,n))},Qt=t=>{const e=zt(t),n=t.selection.getSelectedBlocks();return((t,e)=>a(t)&&1===e.length&&e[0]===t)(e,n)?(t=>L(t.querySelectorAll(Vt),Ct))(e):L(n,(t=>Ct(t)&&e!==t))},qt=t=>{const e=t.selection.getSelectedBlocks();return L(((t,e)=>{const n=gt.map(e,(e=>t.dom.getParent(e,"li,dd,dt",Zt(t,e))||e));return B(n)})(t,e),Nt)},Wt=(t,e)=>{const n=t.dom.getParents(e,"TD,TH");return n.length>0?n[0]:t.getBody()},Zt=(t,e)=>{const n=t.dom.getParents(e,t.dom.isBlock),o=O(n,(e=>{return n=t.schema,!Ct(o=e)&&!Nt(o)&&b(Kt,(t=>n.isValidChild(o.nodeName,t)));var n,o}));return o.getOr(t.getBody())},Gt=(t,e)=>{const n=t.dom.getParents(e,"ol,ul",Zt(t,e));return x(n)},Jt=t=>{const e=(t=>{const e=Gt(t,t.selection.getStart()),n=L(t.selection.getSelectedBlocks(),bt);return e.toArray().concat(n)})(t);return Xt(t,e)},Xt=(t,e)=>{const n=S(e,(e=>Gt(t,e).getOr(e)));return B(n)},Yt=t=>/\btox\-/.test(t.className),te=(t,e)=>D(t,Ct,Tt).exists((t=>t.nodeName===e&&!Yt(t))),ee=(t,e)=>null!==e&&"false"===t.dom.getContentEditableParent(e),ne=(t,e)=>{const n=t.dom.getParent(e,"ol,ul,dl");return ee(t,n)},oe=(t,e)=>{const n=t.selection.getNode();return e({parents:t.dom.getParents(n),element:n}),t.on("NodeChange",e),()=>t.off("NodeChange",e)},re=(t,e,n)=>t.dispatch("ListMutation",{action:e,element:n}),se=(ie=/^\s+|\s+$/g,t=>t.replace(ie,""));var ie;const ae=(t,e,n)=>{if(!o(n))throw console.error("Invalid call to CSS.set. Property ",e,":: Value ",n,":: Element ",t),new Error("CSS value must be a string: "+n);(t=>void 0!==t.style&&l(t.style.getPropertyValue))(t)&&t.style.setProperty(e,n)},le=(t,e,n)=>{const o=t.dom;ae(o,e,n)},de=(t,e)=>{X(t.item,e.list)},ce=(t,e)=>{const n={list:R.fromTag(e,t),item:R.fromTag("li",t)};return X(n.list,n.item),n},me=(t,e,n)=>{const o=e.slice(0,n.depth);return x(o).each((e=>{const o=((t,e,n)=>{const o=R.fromTag("li",t);return dt(o,e),Y(o,n),o})(t,n.itemAttributes,n.content);((t,e)=>{X(t.list,e),t.item=e})(e,o),((t,e)=>{_(t.list)!==e.listType&&(t.list=ut(t.list,e.listType)),dt(t.list,e.listAttributes)})(e,n)})),o},ue=(t,e,n)=>{const o=((t,e,n)=>{const o=[];for(let r=0;r<n;r++)o.push(ce(t,e.listType));return o})(t,n,n.depth-e.length);var r;return(t=>{for(let e=1;e<t.length;e++)de(t[e-1],t[e])})(o),((t,e)=>{for(let e=0;e<t.length-1;e++)le(t[e].item,"list-style-type","none");x(t).each((t=>{dt(t.list,e.listAttributes),dt(t.item,e.itemAttributes),Y(t.item,e.content)}))})(o,n),r=o,M(x(e),E(r),de),e.concat(o)},pe=t=>$(t,"OL,UL"),ge=t=>Q(t).exists(pe),fe=t=>t.depth>0,he=t=>t.isSelected,ye=t=>{const e=V(t),n=q(t).exists(pe)?e.slice(0,-1):e;return S(n,mt)},ve=t=>(N(t,((e,n)=>{((t,e)=>{const n=t[e].depth,o=t=>t.depth===n&&!t.dirty,r=t=>t.depth<n;return D(A(t.slice(0,e)),o,r).orThunk((()=>D(t.slice(e+1),o,r)))})(t,n).fold((()=>{e.dirty&&(t=>{t.listAttributes=lt(t.listAttributes,((t,e)=>"start"!==e))})(e)}),(t=>{return o=t,(n=e).listType=o.listType,void(n.listAttributes={...o.listAttributes});var n,o}))})),t),Ce=(t,e,n,o)=>Q(o).filter(pe).fold((()=>{e.each((t=>{U(t.start,o)&&n.set(!0)}));const r=((t,e,n)=>K(t).filter(H).map((o=>({depth:e,dirty:!1,isSelected:n,content:ye(t),itemAttributes:ct(t),listAttributes:ct(o),listType:_(o)}))))(o,t,n.get());e.each((t=>{U(t.end,o)&&n.set(!1)}));const s=q(o).filter(pe).map((o=>be(t,e,n,o))).getOr([]);return r.toArray().concat(s)}),(o=>be(t,e,n,o))),be=(t,e,n,o)=>k(V(o),(o=>(pe(o)?be:Ce)(t+1,e,n,o))),Se=(t,e)=>{const n=ve(e);return S(n,(e=>{const n=((t,e)=>{const n=(e||document).createDocumentFragment();return N(t,(t=>{n.appendChild(t.dom)})),R.fromDom(n)})(e.content);return R.fromDom(Mt(t,n.dom))}))},Ne=(t,e)=>{const n=ve(e);return((t,e)=>{const n=T(e,((e,n)=>n.depth>e.length?ue(t,e,n):me(t,e,n)),[]);return E(n).map((t=>t.list))})(t.contentDocument,n).toArray()},Le=(t,e,n)=>{const o=((t,e)=>{const n=(t=>{let e=!1;return{get:()=>e,set:t=>{e=t}}})();return S(t,(t=>({sourceList:t,entries:be(0,e,n,t)})))})(e,(t=>{const e=S(qt(t),R.fromDom);return M(O(e,u(ge)),O(A(e),u(ge)),((t,e)=>({start:t,end:e})))})(t));N(o,(e=>{((t,e)=>{N(L(t,he),(t=>((t,e)=>{switch(t){case"Indent":e.depth++;break;case"Outdent":e.depth--;break;case"Flatten":e.depth=0}e.dirty=!0})(e,t)))})(e.entries,n);const o=((t,e)=>k(((t,e)=>{if(0===t.length)return[];{let n=e(t[0]);const o=[];let r=[];for(let s=0,i=t.length;s<i;s++){const i=t[s],a=e(i);a!==n&&(o.push(r),r=[]),n=a,r.push(i)}return 0!==r.length&&o.push(r),o}})(e,fe),(e=>E(e).exists(fe)?Ne(t,e):Se(t,e))))(t,e.entries);var r;N(o,(e=>{re(t,"Indent"===n?"IndentList":"OutdentList",e.dom)})),r=e.sourceList,N(o,(t=>{G(r,t)})),et(e.sourceList)}))},Te=(t,e)=>{const n=st(Jt(t)),o=st((t=>L(qt(t),Lt))(t));let r=!1;if(n.length||o.length){const s=t.selection.getBookmark();Le(t,n,e),((t,e,n)=>{N(n,"Indent"===e?Ht:e=>_t(t,e))})(t,e,o),t.selection.moveToBookmark(s),t.selection.setRng(jt(t.selection.getRng())),t.nodeChanged(),r=!0}return r},De=(t,e)=>!(t=>{const e=zt(t);return ee(t,e)})(t)&&Te(t,e),Oe=t=>De(t,"Indent"),ke=t=>De(t,"Outdent"),Ae=t=>De(t,"Flatten");var we=tinymce.util.Tools.resolve("tinymce.dom.BookmarkManager");const Ee=pt.DOM,xe=t=>{const e={},n=n=>{let o=t[n?"startContainer":"endContainer"],r=t[n?"startOffset":"endOffset"];if(vt(o)){const t=Ee.create("span",{"data-mce-type":"bookmark"});o.hasChildNodes()?(r=Math.min(r,o.childNodes.length-1),n?o.insertBefore(t,o.childNodes[r]):Ee.insertAfter(t,o.childNodes[r])):o.appendChild(t),o=t,r=0}e[n?"startContainer":"endContainer"]=o,e[n?"startOffset":"endOffset"]=r};return n(!0),t.collapsed||n(),e},Be=t=>{const e=e=>{let n=t[e?"startContainer":"endContainer"],o=t[e?"startOffset":"endOffset"];if(n){if(vt(n)&&n.parentNode){const t=n;o=(t=>{var e;let n=null===(e=t.parentNode)||void 0===e?void 0:e.firstChild,o=0;for(;n;){if(n===t)return o;vt(n)&&"bookmark"===n.getAttribute("data-mce-type")||o++,n=n.nextSibling}return-1})(n),n=n.parentNode,Ee.remove(t),!n.hasChildNodes()&&Ee.isBlock(n)&&n.appendChild(Ee.create("br"))}t[e?"startContainer":"endContainer"]=n,t[e?"startOffset":"endOffset"]=o}};e(!0),e();const n=Ee.createRng();return n.setStart(t.startContainer,t.startOffset),t.endContainer&&n.setEnd(t.endContainer,t.endOffset),jt(n)},Pe=t=>{switch(t){case"UL":return"ToggleUlList";case"OL":return"ToggleOlList";case"DL":return"ToggleDLList"}},Me=(t,e)=>{gt.each(e,((e,n)=>{t.setAttribute(n,e)}))},Ie=(t,e,n)=>{((t,e,n)=>{const o=n["list-style-type"]?n["list-style-type"]:null;t.setStyle(e,"list-style-type",o)})(t,e,n),((t,e,n)=>{Me(e,n["list-attributes"]),gt.each(t.select("li",e),(t=>{Me(t,n["list-item-attributes"])}))})(t,e,n)},Re=(t,e,n,o)=>{let r=e[n?"startContainer":"endContainer"];const s=e[n?"startOffset":"endOffset"];for(vt(r)&&(r=r.childNodes[Math.min(s,r.childNodes.length-1)]||r),!n&&Dt(r.nextSibling)&&(r=r.nextSibling);r.parentNode!==o;){const e=r.parentNode;if(Ot(t,r))return r;if(/^(TD|TH)$/.test(e.nodeName))return r;r=e}return r},Ue=(t,e,n)=>{const o=t.selection.getRng();let r="LI";const s=Zt(t,t.selection.getStart(!0)),i=t.dom;if("false"===i.getContentEditable(t.selection.getNode()))return;"DL"===(e=e.toUpperCase())&&(r="DT");const a=xe(o),l=((t,e,n)=>{const o=[],r=t.dom,s=Re(t,e,!0,n),i=Re(t,e,!1,n);let a;const l=[];for(let t=s;t&&(l.push(t),t!==i);t=t.nextSibling);return gt.each(l,(e=>{var s;if(Ot(t,e))return o.push(e),void(a=null);if(r.isBlock(e)||Dt(e))return Dt(e)&&r.remove(e),void(a=null);const i=e.nextSibling;we.isBookmarkNode(e)&&(Ct(i)||Ot(t,i)||!i&&e.parentNode===n)?a=null:(a||(a=r.create("p"),null===(s=e.parentNode)||void 0===s||s.insertBefore(a,e),o.push(a)),a.appendChild(e))})),o})(t,o,s);gt.each(l,(o=>{let s;const a=o.previousSibling,l=o.parentNode;Nt(l)||(a&&Ct(a)&&a.nodeName===e&&((t,e,n)=>{const o=t.getStyle(e,"list-style-type");let r=n?n["list-style-type"]:"";return r=null===r?"":r,o===r})(i,a,n)?(s=a,o=i.rename(o,r),a.appendChild(o)):(s=i.create(e),l.insertBefore(s,o),s.appendChild(o),o=i.rename(o,r)),((t,e,n)=>{gt.each(n,(n=>t.setStyle(e,n,"")))})(i,o,["margin","margin-right","margin-bottom","margin-left","margin-top","padding","padding-right","padding-bottom","padding-left","padding-top"]),Ie(i,s,n),_e(t.dom,s))})),t.selection.setRng(Be(a))},$e=(t,e,n)=>{return((t,e)=>Ct(t)&&t.nodeName===(null==e?void 0:e.nodeName))(e,n)&&((t,e,n)=>t.getStyle(e,"list-style-type",!0)===t.getStyle(n,"list-style-type",!0))(t,e,n)&&(o=n,e.className===o.className);var o},_e=(t,e)=>{let n,o=e.nextSibling;if($e(t,e,o)){const r=o;for(;n=r.firstChild;)e.appendChild(n);t.remove(r)}if(o=e.previousSibling,$e(t,e,o)){const r=o;for(;n=r.lastChild;)e.insertBefore(n,e.firstChild);t.remove(r)}},He=(t,e,n,o,r)=>{const s=Ct(e);if(s&&e.nodeName===o&&!Fe(r))Ae(t);else{Ue(t,o,r);const i=xe(t.selection.getRng()),a=s?[e,...n]:n;gt.each(a,(e=>{((t,e,n,o)=>{if(e.nodeName!==n){const r=t.dom.rename(e,n);Ie(t.dom,r,o),re(t,Pe(n),r)}else Ie(t.dom,e,o),re(t,Pe(n),e)})(t,e,o,r)})),t.selection.setRng(Be(i))}},Fe=t=>"list-style-type"in t,je=(t,e,n)=>{const o=zt(t);if(ne(t,o))return;const s=Qt(t),i=r(n)?n:{};s.length>0?He(t,o,s,e,i):((t,e,n,o)=>{if(e!==t.getBody())if(e)if(e.nodeName!==n||Fe(o)||Yt(e)){const r=xe(t.selection.getRng());Ie(t.dom,e,o);const s=t.dom.rename(e,n);_e(t.dom,s),t.selection.setRng(Be(r)),Ue(t,n,o),re(t,Pe(n),s)}else Ae(t);else Ue(t,n,o),re(t,Pe(n),e)})(t,o,e,i)},Ke=pt.DOM,Ve=(t,e)=>{const n=gt.grep(t.select("ol,ul",e));gt.each(n,(e=>{((t,e)=>{const n=e.parentElement;if(n&&"LI"===n.nodeName&&n.firstChild===e){const o=n.previousSibling;o&&"LI"===o.nodeName?(o.appendChild(e),At(t,n)&&Ke.remove(n)):Ke.setStyle(n,"listStyleType","none")}if(Ct(n)){const t=n.previousSibling;t&&"LI"===t.nodeName&&t.appendChild(e)}})(t,e)}))},ze=(t,e,n,o)=>{let r=e.startContainer;const s=e.startOffset;if(yt(r)&&(n?s<r.data.length:s>0))return r;const i=t.schema.getNonEmptyElements();vt(r)&&(r=nt.getNode(r,s));const a=new ot(r,o);n&&((t,e)=>!!Dt(e)&&t.isBlock(e.nextSibling)&&!Dt(e.previousSibling))(t.dom,r)&&a.next();const l=n?a.next.bind(a):a.prev2.bind(a);for(;r=l();){if("LI"===r.nodeName&&!r.hasChildNodes())return r;if(i[r.nodeName])return r;if(yt(r)&&r.data.length>0)return r}return null},Qe=(t,e)=>{const n=e.childNodes;return 1===n.length&&!Ct(n[0])&&t.isBlock(n[0])},qe=(t,e,n)=>{let o;const r=Qe(t,n)?n.firstChild:n;if(((t,e)=>{Qe(t,e)&&t.remove(e.firstChild,!0)})(t,e),!At(t,e,!0))for(;o=e.firstChild;)r.appendChild(o)},We=(t,e,n)=>{let o;const r=e.parentNode;if(!wt(t,e)||!wt(t,n))return;Ct(n.lastChild)&&(o=n.lastChild),r===n.lastChild&&Dt(r.previousSibling)&&t.remove(r.previousSibling);const s=n.lastChild;s&&Dt(s)&&e.hasChildNodes()&&t.remove(s),At(t,n,!0)&&tt(R.fromDom(n)),qe(t,e,n),o&&n.appendChild(o);const i=((t,e)=>{const n=t.dom,o=e.dom;return n!==o&&n.contains(o)})(R.fromDom(n),R.fromDom(e))?t.getParents(e,Ct,n):[];t.remove(e),N(i,(e=>{At(t,e)&&e!==t.getRoot()&&t.remove(e)}))},Ze=(t,e,n,o)=>{const r=t.dom;if(r.isEmpty(o))((t,e,n)=>{tt(R.fromDom(n)),We(t.dom,e,n),t.selection.setCursorLocation(n,0)})(t,n,o);else{const s=xe(e);We(r,n,o),t.selection.setRng(Be(s))}},Ge=(t,e)=>{const n=t.dom,o=t.selection,r=o.getStart(),s=Wt(t,r),i=n.getParent(o.getStart(),"LI",s);if(i){const r=i.parentElement;if(r===t.getBody()&&At(n,r))return!0;const a=jt(o.getRng()),l=n.getParent(ze(t,a,e,s),"LI",s);if(l&&l!==i)return t.undoManager.transact((()=>{var n,o;e?Ze(t,a,l,i):(null===(o=(n=i).parentNode)||void 0===o?void 0:o.firstChild)===n?ke(t):((t,e,n,o)=>{const r=xe(e);We(t.dom,n,o);const s=Be(r);t.selection.setRng(s)})(t,a,i,l)})),!0;if(!l&&!e&&0===a.startOffset&&0===a.endOffset)return t.undoManager.transact((()=>{Ae(t)})),!0}return!1},Je=(t,e)=>{const n=t.dom,o=t.selection.getStart(),r=Wt(t,o),s=n.getParent(o,n.isBlock,r);if(s&&n.isEmpty(s)){const o=jt(t.selection.getRng()),i=n.getParent(ze(t,o,e,r),"LI",r);if(i){const a=t=>C(["td","th","caption"],_(t)),l=t=>t.dom===r;return!!((t,e,n=m)=>M(t,e,n).getOr(t.isNone()&&e.isNone()))(Z(R.fromDom(i),a,l),Z(R.fromDom(o.startContainer),a,l),U)&&(t.undoManager.transact((()=>{((t,e,n)=>{const o=t.getParent(e.parentNode,t.isBlock,n);t.remove(e),o&&t.isEmpty(o)&&t.remove(o)})(n,s,r),_e(n,i.parentNode),t.selection.select(i,!0),t.selection.collapse(e)})),!0)}}return!1},Xe=t=>{const e=t.selection.getStart(),n=Wt(t,e);return t.dom.getParent(e,"LI,DT,DD",n)||qt(t).length>0},Ye=(t,e)=>{const n=t.selection;return!ne(t,n.getNode())&&(n.isCollapsed()?((t,e)=>Ge(t,e)||Je(t,e))(t,e):(t=>!!Xe(t)&&(t.undoManager.transact((()=>{t.execCommand("Delete"),Ve(t.dom,t.getBody())})),!0))(t))},tn=t=>{const e=A(se(t).split("")),n=S(e,((t,e)=>{const n=t.toUpperCase().charCodeAt(0)-"A".charCodeAt(0)+1;return Math.pow(26,e)*n}));return T(n,((t,e)=>t+e),0)},en=t=>{if(--t<0)return"";{const e=t%26,n=Math.floor(t/26);return en(n)+String.fromCharCode("A".charCodeAt(0)+e)}},nn=t=>{const e=parseInt(t.start,10);return P(t.listStyleType,"upper-alpha")?en(e):P(t.listStyleType,"lower-alpha")?en(e).toLowerCase():t.start},on=t=>{const e=zt(t);St(e)&&!ne(t,e)&&t.windowManager.open({title:"List Properties",body:{type:"panel",items:[{type:"input",name:"start",label:"Start list at number",inputMode:"numeric"}]},initialData:{start:nn({start:t.dom.getAttrib(e,"start","1"),listStyleType:f.from(t.dom.getStyle(e,"list-style-type"))})},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:e=>{(t=>{switch((t=>/^[0-9]+$/.test(t)?2:/^[A-Z]+$/.test(t)?0:(t=>/^[a-z]+$/.test(t))(t)?1:t.length>0?4:3)(t)){case 2:return f.some({listStyleType:f.none(),start:t});case 0:return f.some({listStyleType:f.some("upper-alpha"),start:tn(t).toString()});case 1:return f.some({listStyleType:f.some("lower-alpha"),start:tn(t).toString()});case 3:return f.some({listStyleType:f.none(),start:""});case 4:return f.none()}})(e.getData().start).each((e=>{t.execCommand("mceListUpdate",!1,{attrs:{start:"1"===e.start?"":e.start},styles:{"list-style-type":e.listStyleType.getOr("")}})})),e.close()}})},rn=(t,e)=>()=>{const n=zt(t);return a(n)&&n.nodeName===e},sn=t=>{t.addCommand("mceListProps",(()=>{on(t)}))},an=t=>{t.on("BeforeExecCommand",(e=>{const n=e.command.toLowerCase();"indent"===n?Oe(t):"outdent"===n&&ke(t)})),t.addCommand("InsertUnorderedList",((e,n)=>{je(t,"UL",n)})),t.addCommand("InsertOrderedList",((e,n)=>{je(t,"OL",n)})),t.addCommand("InsertDefinitionList",((e,n)=>{je(t,"DL",n)})),t.addCommand("RemoveList",(()=>{Ae(t)})),sn(t),t.addCommand("mceListUpdate",((e,n)=>{r(n)&&((t,e)=>{const n=zt(t);null===n||ne(t,n)||t.undoManager.transact((()=>{r(e.styles)&&t.dom.setStyles(n,e.styles),r(e.attrs)&&at(e.attrs,((e,o)=>t.dom.setAttrib(n,o,e)))}))})(t,n)})),t.addQueryStateHandler("InsertUnorderedList",rn(t,"UL")),t.addQueryStateHandler("InsertOrderedList",rn(t,"OL")),t.addQueryStateHandler("InsertDefinitionList",rn(t,"DL"))},ln=t=>{xt(t)&&(t=>{t.on("keydown",(e=>{e.keyCode!==rt.TAB||rt.metaKeyPressed(e)||t.undoManager.transact((()=>{(e.shiftKey?ke(t):Oe(t))&&e.preventDefault()}))}))})(t),(t=>{t.on("ExecCommand",(e=>{const n=e.command.toLowerCase();"delete"!==n&&"forwarddelete"!==n||!Xe(t)||Ve(t.dom,t.getBody())})),t.on("keydown",(e=>{e.keyCode===rt.BACKSPACE?Ye(t,!1)&&e.preventDefault():e.keyCode===rt.DELETE&&Ye(t,!0)&&e.preventDefault()}))})(t)},dn=(t,e)=>n=>oe(t,(o=>{n.setActive(te(o.parents,e)),n.setEnabled(!ne(t,o.element))})),cn=(t,e)=>n=>oe(t,(o=>n.setEnabled(te(o.parents,e)&&!ne(t,o.element))));t.add("lists",(t=>((t=>{(0,t.options.register)("lists_indent_on_tab",{processor:"boolean",default:!0})})(t),t.hasPlugin("rtc",!0)?sn(t):(ln(t),an(t)),(t=>{const e=e=>()=>t.execCommand(e);t.hasPlugin("advlist")||(t.ui.registry.addToggleButton("numlist",{icon:"ordered-list",active:!1,tooltip:"Numbered list",onAction:e("InsertOrderedList"),onSetup:dn(t,"OL")}),t.ui.registry.addToggleButton("bullist",{icon:"unordered-list",active:!1,tooltip:"Bullet list",onAction:e("InsertUnorderedList"),onSetup:dn(t,"UL")}))})(t),(t=>{const e={text:"List properties...",icon:"ordered-list",onAction:()=>t.execCommand("mceListProps"),onSetup:cn(t,"OL")};t.ui.registry.addMenuItem("listprops",e),t.ui.registry.addContextMenu("lists",{update:e=>{const n=zt(t,e);return St(n)?["listprops"]:[]}})})(t),(t=>({backspaceDelete:e=>{Ye(t,e)}}))(t))))}();