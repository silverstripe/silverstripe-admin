!function(){"use strict";var e={394:function(e){e.exports=ReactDom},265:function(e){e.exports=ShortcodeSerialiser},196:function(e){e.exports=TinyMCEActionRegistrar},754:function(e){e.exports=i18n},311:function(e){e.exports=jQuery}},t={};function n(i){var o=t[i];if(void 0!==o)return o.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,n),r.exports}!function(){var e=s(n(196)),t=s(n(394)),i=s(n(311)),o=n(265),r=s(n(754));function s(e){return e&&e.__esModule?e:{default:e}}const a={init(t){const n=navigator.platform.toUpperCase().includes("MAC")?"âŒ˜":"Ctrl",o=r.default._t("Admin.INSERT_LINK","Insert link"),s=r.default.inject(r.default._t("Admin.INSERT_LINK_WITH_SHORTCUT","Insert link {shortcut}"),{shortcut:`[${n}+K]`}),a=e.default.getSortedActions("sslink",t.getParam("editorIdentifier"),!0).map((e=>Object.assign({},e,{onAction:()=>e.onAction(t)})));return t.ui.registry.addMenuButton("sslink",{icon:"link",tooltip:s,fetch:e=>e(a)}),t.ui.registry.addNestedMenuItem("sslink",{icon:"link",text:o,getSubmenuItems:()=>a}),t.addShortcut("Meta+k","Open link menu",(()=>{(0,i.default)(`[aria-label^="${o}"] > button`,t.container).first().click()})),t.ui.registry.addButton("sslink-edit",{text:r.default._t("Admin.EDIT_LINK","Edit link"),onAction:function(){const n=tinymce.activeEditor.selection.getNode().getAttribute("href");n&&t.execCommand(e.default.getEditorCommandFromUrl(n))}}),t.ui.registry.addButton("sslink-remove",{text:r.default._t("Admin.REMOVE_LINK","Remove link"),onAction:()=>this.handleRemoveLinkClick(t)}),t.ui.registry.addContextToolbar("sslink",{predicate:e=>t.dom.is(e,"a[href]"),position:"node",scope:"node",items:"sslink-edit sslink-remove"}),{getMetadata(){return{name:"Silverstripe Link",url:"https://docs.silverstripe.org/en/4/developer_guides/forms/field_types/htmleditorfield"}}}},handleRemoveLinkClick(e){const t=e.execCommand("unlink"),n=e.selection.getNode();return n&&void 0!==n.normalize&&n.normalize(),t}};i.default.entwine("ss",(e=>{e(".insert-link__dialog-wrapper").entwine({Element:null,Data:{},Bookmark:null,onunmatch(){this._clearModal()},_clearModal(){t.default.unmountComponentAtNode(this[0])},open(){const e=this.getElement().getEditor().getInstance();this.setBookmark(e.selection.getBookmark(2,!0)),this.renderModal(!0)},close(){this.setData({}),this.renderModal(!1)},renderModal(){},checkNodeMatches(e,t){return e===t||1===t.children.length&&e===t.children[0]},linkCanWrapSelection(e,t){const n=e.getSelection()||"",i=t.getNode();if(n)return""!==n.trim();const o=document.createElement(i.nodeName);if(o.textContent="Check the outer HTML",o.outerHTML.includes("Check the outer HTML"))return!1;if(this.checkNodeMatches(i,t.getSel().focusNode)&&this.checkNodeMatches(i,t.getSel().anchorNode)){if(1===tinymce.activeEditor.dom.createFragment(`<a>${i.outerHTML}</a>`).childNodes.length)return!0}return!1},getRequireLinkText(){const e=this.getElement().getEditor(),t=e.getInstance().selection,n=this.linkCanWrapSelection(e,t);return"A"!==t.getNode().tagName&&!n},handleInsert(e){this.getElement().getEditor().getInstance().selection.moveToBookmark(this.getBookmark());const t=this.buildAttributes(e),n=(0,o.createHTMLSanitiser)()(e.Text);return this.insertLinkInEditor(t,n),this.close(),Promise.resolve()},buildAttributes(e){let{Anchor:t,Link:n,TargetBlank:i,Description:o}=e,r=t&&t.length?`#${t}`:"";r=r.replace(/^#+/,"#");return{href:`${n}${r}`,target:i?"_blank":"",title:o}},insertLinkInEditor(e,t){const n=this.getElement().getEditor();n.insertLink(e,null,t),n.addUndo(),n.repaint();const i=n.getInstance().selection;setTimeout((()=>i&&i.collapse()),0)},getOriginalAttributes(){const t=this.getElement().getEditor(),n=e(t.getSelectedNode()),i=(n.attr("href")||"").split("#");return{Link:i[0]||"",Anchor:i[1]||"",Description:n.attr("title"),TargetBlank:!!n.attr("target")}}})})),tinymce.PluginManager.add("sslink",(e=>a.init(e)))}()}();